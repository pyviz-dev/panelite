"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[3090],{5035:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(58646),i=s(11129);t.BaseManager=class{constructor(e){var t;this._isDisposed=!1,this._disposed=new n.Signal(this),this.serverSettings=null!=(t=e.serverSettings)?t:i.ServerConnection.makeSettings()}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._disposed.emit(void 0),n.Signal.clearData(this))}}},37141:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(76528),i=s(11129);t.BuildManager=class{constructor(e={}){var t;this._url="",this.serverSettings=null!=(t=e.serverSettings)?t:i.ServerConnection.makeSettings();const{baseUrl:s,appUrl:r}=this.serverSettings;this._url=n.URLExt.join(s,r,"api/build")}get isAvailable(){return"true"===n.PageConfig.getOption("buildAvailable").toLowerCase()}get shouldCheck(){return"true"===n.PageConfig.getOption("buildCheck").toLowerCase()}getStatus(){const{_url:e,serverSettings:t}=this;return i.ServerConnection.makeRequest(e,{},t).then((e=>{if(200!==e.status)throw new i.ServerConnection.ResponseError(e);return e.json()})).then((e=>{if("string"!=typeof e.status)throw new Error("Invalid data");if("string"!=typeof e.message)throw new Error("Invalid data");return e}))}build(){const{_url:e,serverSettings:t}=this;return i.ServerConnection.makeRequest(e,{method:"POST"},t).then((e=>{if(400===e.status)throw new i.ServerConnection.ResponseError(e,"Build aborted");if(200!==e.status){const t=`Build failed with ${e.status}, please run 'jupyter lab build' on the server for full output`;throw new i.ServerConnection.ResponseError(e,t)}}))}cancel(){const{_url:e,serverSettings:t}=this;return i.ServerConnection.makeRequest(e,{method:"DELETE"},t).then((e=>{if(204!==e.status)throw new i.ServerConnection.ResponseError(e)}))}}},55940:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(76528),i=s(63090);(t.ConfigSection||(t.ConfigSection={})).create=function(e){const t=new r(e);return t.load().then((()=>t))};class r{constructor(e){var t;this._url="unknown";const s=this.serverSettings=null!=(t=e.serverSettings)?t:i.ServerConnection.makeSettings();this._url=n.URLExt.join(s.baseUrl,"api/config",encodeURIComponent(e.name))}get data(){return this._data}async load(){const e=await i.ServerConnection.makeRequest(this._url,{},this.serverSettings);if(200!==e.status)throw await i.ServerConnection.ResponseError.create(e);this._data=await e.json()}async update(e){this._data=Object.assign(Object.assign({},this._data),e);const t={method:"PATCH",body:JSON.stringify(e)},s=await i.ServerConnection.makeRequest(this._url,t,this.serverSettings);if(200!==s.status)throw await i.ServerConnection.ResponseError.create(s);return this._data=await s.json(),this._data}}t.ConfigWithDefaults=class{constructor(e){var t,s;this._className="",this._section=e.section,this._defaults=null!=(t=e.defaults)?t:{},this._className=null!=(s=e.className)?s:""}get(e){const t=this._classData();return e in t?t[e]:this._defaults[e]}set(e,t){const s={};if(s[e]=t,this._className){const e={};return e[this._className]=s,this._section.update(e)}return this._section.update(s)}_classData(){const e=this._section.data;return this._className&&this._className in e?e[this._className]:e}}},40657:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=s(76528),r=s(81734),o=s(58646),a=s(63090),h=n(s(39841));var l,c;(c=t.Contents||(t.Contents={})).validateContentsModel=function(e){h.validateContentsModel(e)},c.validateCheckpointModel=function(e){h.validateCheckpointModel(e)},t.ContentsManager=class{constructor(e={}){var t,s;this._isDisposed=!1,this._additionalDrives=new Map,this._fileChanged=new o.Signal(this);const n=this.serverSettings=null!=(t=e.serverSettings)?t:a.ServerConnection.makeSettings();this._defaultDrive=null!=(s=e.defaultDrive)?s:new d({serverSettings:n}),this._defaultDrive.fileChanged.connect(this._onFileChanged,this)}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,o.Signal.clearData(this))}addDrive(e){this._additionalDrives.set(e.name,e),e.fileChanged.connect(this._onFileChanged,this)}getModelDBFactory(e){var t,s;const[n]=this._driveForPath(e);return null!=(s=null===(t=n)||void 0===t?void 0:t.modelDBFactory)?s:null}localPath(e){const t=e.split("/"),s=t[0].split(":");return 1!==s.length&&this._additionalDrives.has(s[0])?i.PathExt.join(s.slice(1).join(":"),...t.slice(1)):i.PathExt.removeSlash(e)}normalize(e){const t=e.split(":");return 1===t.length?i.PathExt.normalize(e):`${t[0]}:${i.PathExt.normalize(t.slice(1).join(":"))}`}resolvePath(e,t){const s=this.driveName(e),n=this.localPath(e),r=i.PathExt.resolve("/",n,t);return s?`${s}:${r}`:r}driveName(e){const t=e.split("/")[0].split(":");return 1===t.length?"":this._additionalDrives.has(t[0])?t[0]:""}get(e,t){const[s,n]=this._driveForPath(e);return s.get(n,t).then((e=>{const t=[];return"directory"===e.type&&e.content?(r.each(e.content,(e=>{t.push(Object.assign(Object.assign({},e),{path:this._toGlobalPath(s,e.path)}))})),Object.assign(Object.assign({},e),{path:this._toGlobalPath(s,n),content:t})):Object.assign(Object.assign({},e),{path:this._toGlobalPath(s,n)})}))}getDownloadUrl(e){const[t,s]=this._driveForPath(e);return t.getDownloadUrl(s)}newUntitled(e={}){if(e.path){const t=this.normalize(e.path),[s,n]=this._driveForPath(t);return s.newUntitled(Object.assign(Object.assign({},e),{path:n})).then((e=>Object.assign(Object.assign({},e),{path:i.PathExt.join(t,e.name)})))}return this._defaultDrive.newUntitled(e)}delete(e){const[t,s]=this._driveForPath(e);return t.delete(s)}rename(e,t){const[s,n]=this._driveForPath(e),[i,r]=this._driveForPath(t);if(s!==i)throw Error("ContentsManager: renaming files must occur within a Drive");return s.rename(n,r).then((e=>Object.assign(Object.assign({},e),{path:this._toGlobalPath(s,r)})))}save(e,t={}){const s=this.normalize(e),[n,i]=this._driveForPath(e);return n.save(i,Object.assign(Object.assign({},t),{path:i})).then((e=>Object.assign(Object.assign({},e),{path:s})))}copy(e,t){const[s,n]=this._driveForPath(e),[i,r]=this._driveForPath(t);if(s===i)return s.copy(n,r).then((e=>Object.assign(Object.assign({},e),{path:this._toGlobalPath(s,e.path)})));throw Error("Copying files between drives is not currently implemented")}createCheckpoint(e){const[t,s]=this._driveForPath(e);return t.createCheckpoint(s)}listCheckpoints(e){const[t,s]=this._driveForPath(e);return t.listCheckpoints(s)}restoreCheckpoint(e,t){const[s,n]=this._driveForPath(e);return s.restoreCheckpoint(n,t)}deleteCheckpoint(e,t){const[s,n]=this._driveForPath(e);return s.deleteCheckpoint(n,t)}_toGlobalPath(e,t){return e===this._defaultDrive?i.PathExt.removeSlash(t):`${e.name}:${i.PathExt.removeSlash(t)}`}_driveForPath(e){const t=this.driveName(e),s=this.localPath(e);return t?[this._additionalDrives.get(t),s]:[this._defaultDrive,s]}_onFileChanged(e,t){var s,n;if(e===this._defaultDrive)this._fileChanged.emit(t);else{let i=null,r=null;(null===(s=t.newValue)||void 0===s?void 0:s.path)&&(i=Object.assign(Object.assign({},t.newValue),{path:this._toGlobalPath(e,t.newValue.path)})),(null===(n=t.oldValue)||void 0===n?void 0:n.path)&&(r=Object.assign(Object.assign({},t.oldValue),{path:this._toGlobalPath(e,t.oldValue.path)})),this._fileChanged.emit({type:t.type,newValue:i,oldValue:r})}}};class d{constructor(e={}){var t,s,n;this._isDisposed=!1,this._fileChanged=new o.Signal(this),this.name=null!=(t=e.name)?t:"Default",this._apiEndpoint=null!=(s=e.apiEndpoint)?s:"api/contents",this.serverSettings=null!=(n=e.serverSettings)?n:a.ServerConnection.makeSettings()}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,o.Signal.clearData(this))}async get(e,t){let s=this._getUrl(e);if(t){"notebook"===t.type&&delete t.format;const e=t.content?"1":"0",n=Object.assign(Object.assign({},t),{content:e});s+=i.URLExt.objectToQueryString(n)}const n=this.serverSettings,r=await a.ServerConnection.makeRequest(s,{},n);if(200!==r.status)throw await a.ServerConnection.ResponseError.create(r);const o=await r.json();return h.validateContentsModel(o),o}getDownloadUrl(e){const t=this.serverSettings.baseUrl;let s=i.URLExt.join(t,"files",i.URLExt.encodeParts(e));const n=document.cookie.match("\\b_xsrf=([^;]*)\\b");if(n){const e=new URL(s);e.searchParams.append("_xsrf",n[1]),s=e.toString()}return Promise.resolve(s)}async newUntitled(e={}){var t;let s="{}";e&&(e.ext&&(e.ext=l.normalizeExtension(e.ext)),s=JSON.stringify(e));const n=this.serverSettings,i=this._getUrl(null!=(t=e.path)?t:""),r={method:"POST",body:s},o=await a.ServerConnection.makeRequest(i,r,n);if(201!==o.status)throw await a.ServerConnection.ResponseError.create(o);const c=await o.json();return h.validateContentsModel(c),this._fileChanged.emit({type:"new",oldValue:null,newValue:c}),c}async delete(e){const t=this._getUrl(e),s=this.serverSettings,n=await a.ServerConnection.makeRequest(t,{method:"DELETE"},s);if(204!==n.status)throw await a.ServerConnection.ResponseError.create(n);this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t){const s=this.serverSettings,n=this._getUrl(e),i={method:"PATCH",body:JSON.stringify({path:t})},r=await a.ServerConnection.makeRequest(n,i,s);if(200!==r.status)throw await a.ServerConnection.ResponseError.create(r);const o=await r.json();return h.validateContentsModel(o),this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:o}),o}async save(e,t={}){const s=this.serverSettings,n=this._getUrl(e),i={method:"PUT",body:JSON.stringify(t)},r=await a.ServerConnection.makeRequest(n,i,s);if(200!==r.status&&201!==r.status)throw await a.ServerConnection.ResponseError.create(r);const o=await r.json();return h.validateContentsModel(o),this._fileChanged.emit({type:"save",oldValue:null,newValue:o}),o}async copy(e,t){const s=this.serverSettings,n=this._getUrl(t),i={method:"POST",body:JSON.stringify({copy_from:e})},r=await a.ServerConnection.makeRequest(n,i,s);if(201!==r.status)throw await a.ServerConnection.ResponseError.create(r);const o=await r.json();return h.validateContentsModel(o),this._fileChanged.emit({type:"new",oldValue:null,newValue:o}),o}async createCheckpoint(e){const t=this._getUrl(e,"checkpoints"),s=await a.ServerConnection.makeRequest(t,{method:"POST"},this.serverSettings);if(201!==s.status)throw await a.ServerConnection.ResponseError.create(s);const n=await s.json();return h.validateCheckpointModel(n),n}async listCheckpoints(e){const t=this._getUrl(e,"checkpoints"),s=await a.ServerConnection.makeRequest(t,{},this.serverSettings);if(200!==s.status)throw await a.ServerConnection.ResponseError.create(s);const n=await s.json();if(!Array.isArray(n))throw new Error("Invalid Checkpoint list");for(let e=0;e<n.length;e++)h.validateCheckpointModel(n[e]);return n}async restoreCheckpoint(e,t){const s=this._getUrl(e,"checkpoints",t),n=await a.ServerConnection.makeRequest(s,{method:"POST"},this.serverSettings);if(204!==n.status)throw await a.ServerConnection.ResponseError.create(n)}async deleteCheckpoint(e,t){const s=this._getUrl(e,"checkpoints",t),n=await a.ServerConnection.makeRequest(s,{method:"DELETE"},this.serverSettings);if(204!==n.status)throw await a.ServerConnection.ResponseError.create(n)}_getUrl(...e){const t=e.map((e=>i.URLExt.encodeParts(e))),s=this.serverSettings.baseUrl;return i.URLExt.join(s,this._apiEndpoint,...t)}}t.Drive=d,function(e){e.normalizeExtension=function(e){return e.length>0&&0!==e.indexOf(".")&&(e=`.${e}`),e}}(l||(l={}))},39841:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(61450);t.validateContentsModel=function(e){n.validateProperty(e,"name","string"),n.validateProperty(e,"path","string"),n.validateProperty(e,"type","string"),n.validateProperty(e,"created","string"),n.validateProperty(e,"last_modified","string"),n.validateProperty(e,"mimetype","object"),n.validateProperty(e,"content","object"),n.validateProperty(e,"format","object")},t.validateCheckpointModel=function(e){n.validateProperty(e,"id","string"),n.validateProperty(e,"last_modified","string")}},63090:(e,t,s)=>{function n(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),n(s(55940)),n(s(40657)),n(s(46870)),n(s(53599)),n(s(98057)),n(s(11129)),n(s(72101)),n(s(61229)),n(s(64021)),n(s(79121)),n(s(53064))},58325:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=s(18108),r=n(s(9995));class o extends i.DisposableDelegate{constructor(e,t,s,n){super(n),this._target="",this._id="",this._id=t,this._target=e,this._kernel=s}get commId(){return this._id}get targetName(){return this._target}get onClose(){return this._onClose}set onClose(e){this._onClose=e}get onMsg(){return this._onMsg}set onMsg(e){this._onMsg=e}open(e,t,s=[]){if(this.isDisposed||this._kernel.isDisposed)throw new Error("Cannot open");const n=r.createMessage({msgType:"comm_open",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,content:{comm_id:this._id,target_name:this._target,data:null!=e?e:{}},metadata:t,buffers:s});return this._kernel.sendShellMessage(n,!1,!0)}send(e,t,s=[],n=!0){if(this.isDisposed||this._kernel.isDisposed)throw new Error("Cannot send");const i=r.createMessage({msgType:"comm_msg",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,content:{comm_id:this._id,data:e},metadata:t,buffers:s});return this._kernel.sendShellMessage(i,!1,n)}close(e,t,s=[]){if(this.isDisposed||this._kernel.isDisposed)throw new Error("Cannot close");const n=r.createMessage({msgType:"comm_close",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,content:{comm_id:this._id,data:null!=e?e:{}},metadata:t,buffers:s}),i=this._kernel.sendShellMessage(n,!1,!0),o=this._onClose;return o&&o(r.createMessage({msgType:"comm_close",channel:"iopub",username:this._kernel.username,session:this._kernel.clientId,content:{comm_id:this._id,data:null!=e?e:{}},metadata:t,buffers:s})),this.dispose(),i}}t.CommHandler=o},38898:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=s(76528),r=s(74547),o=s(58646),a=s(63090),h=s(58325),l=n(s(9995)),c=s(8356),d=n(s(59127)),u=n(s(38282)),_=s(53599),g=n(s(64907)),p="_RESTARTING_";class m{constructor(e){var t,s,n,h;this._createSocket=()=>{this._errorIfDisposed(),this._clearSocket(),this._updateConnectionStatus("connecting");const e=this.serverSettings,t=i.URLExt.join(e.wsUrl,g.KERNEL_SERVICE_URL,encodeURIComponent(this._id)),s=t.replace(/^((?:\w+:)?\/\/)(?:[^@\/]+@)/,"$1");console.debug(`Starting WebSocket: ${s}`);let n=i.URLExt.join(t,"channels?session_id="+encodeURIComponent(this._clientId));this._ws=new e.WebSocket(n),this._ws.binaryType="arraybuffer",this._ws.onmessage=this._onWSMessage,this._ws.onopen=this._onWSOpen,this._ws.onclose=this._onWSClose,this._ws.onerror=this._onWSClose},this._onWSOpen=e=>{this._updateConnectionStatus("connected")},this._onWSMessage=e=>{let t;try{t=d.deserialize(e.data),u.validateMessage(t)}catch(e){throw e.message=`Kernel message validation error: ${e.message}`,e}this._kernelSession=t.header.session,this._msgChain=this._msgChain.then((()=>this._handleMessage(t))).catch((e=>{e.message.startsWith("Canceled future for ")&&console.error(e)})),this._anyMessage.emit({msg:t,direction:"recv"})},this._onWSClose=e=>{this.isDisposed||this._reconnect()},this._id="",this._name="",this._status="unknown",this._connectionStatus="connecting",this._kernelSession="",this._isDisposed=!1,this._ws=null,this._username="",this._reconnectLimit=7,this._reconnectAttempt=0,this._reconnectTimeout=null,this._futures=new Map,this._comms=new Map,this._targetRegistry=Object.create(null),this._info=new r.PromiseDelegate,this._pendingMessages=[],this._statusChanged=new o.Signal(this),this._connectionStatusChanged=new o.Signal(this),this._disposed=new o.Signal(this),this._iopubMessage=new o.Signal(this),this._anyMessage=new o.Signal(this),this._unhandledMessage=new o.Signal(this),this._displayIdToParentIds=new Map,this._msgIdToDisplayIds=new Map,this._msgChain=Promise.resolve(),this._noOp=()=>{},this._name=e.model.name,this._id=e.model.id,this.serverSettings=null!=(t=e.serverSettings)?t:a.ServerConnection.makeSettings(),this._clientId=null!=(s=e.clientId)?s:r.UUID.uuid4(),this._username=null!=(n=e.username)?n:"",this.handleComms=null==(h=e.handleComms)||h,this._createSocket(),this.requestKernelInfo()}get disposed(){return this._disposed}get statusChanged(){return this._statusChanged}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get model(){return{id:this.id,name:this.name}}get anyMessage(){return this._anyMessage}get id(){return this._id}get name(){return this._name}get username(){return this._username}get clientId(){return this._clientId}get status(){return this._status}get connectionStatus(){return this._connectionStatus}get isDisposed(){return this._isDisposed}get info(){return this._info.promise}get spec(){return this._specPromise||(this._specPromise=_.KernelSpecAPI.getSpecs(this.serverSettings).then((e=>e.kernelspecs[this._name]))),this._specPromise}clone(e={}){return new m(Object.assign({model:this.model,username:this.username,serverSettings:this.serverSettings,handleComms:!1},e))}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._updateConnectionStatus("disconnected"),this._clearKernelState(),this._pendingMessages=[],this._clearSocket(),o.Signal.clearData(this))}sendShellMessage(e,t=!1,s=!0){return this._sendKernelShellControl(c.KernelShellFutureHandler,e,t,s)}sendControlMessage(e,t=!1,s=!0){return this._sendKernelShellControl(c.KernelControlFutureHandler,e,t,s)}_sendKernelShellControl(e,t,s=!1,n=!0){this._sendMessage(t),this._anyMessage.emit({msg:t,direction:"send"});const i=new e((()=>{const e=t.header.msg_id;this._futures.delete(e);const s=this._msgIdToDisplayIds.get(e);s&&(s.forEach((t=>{const s=this._displayIdToParentIds.get(t);if(s){const n=s.indexOf(e);if(-1===n)return;1===s.length?this._displayIdToParentIds.delete(t):(s.splice(n,1),this._displayIdToParentIds.set(t,s))}})),this._msgIdToDisplayIds.delete(e))}),t,s,n,this);return this._futures.set(t.header.msg_id,i),i}_sendMessage(e,t=!0){if("dead"===this.status)throw new Error("Kernel is dead");if("connected"===this.connectionStatus&&this._kernelSession!==p)this._ws.send(d.serialize(e));else{if(!t)throw new Error("Could not send message");this._pendingMessages.push(e)}}async interrupt(){if("dead"===this.status)throw new Error("Kernel is dead");return g.interruptKernel(this.id,this.serverSettings)}async restart(){if("dead"===this.status)throw new Error("Kernel is dead");this._clearKernelState(),this._updateStatus("restarting"),this._kernelSession=p,await g.restartKernel(this.id,this.serverSettings)}reconnect(){this._errorIfDisposed();const e=new r.PromiseDelegate,t=(s,n)=>{"connected"===n?(e.resolve(),this.connectionStatusChanged.disconnect(t,this)):"disconnected"===n&&(e.reject(new Error("Kernel connection disconnected")),this.connectionStatusChanged.disconnect(t,this))};return this.connectionStatusChanged.connect(t,this),this._reconnectAttempt=0,this._reconnect(),e.promise}async shutdown(){"dead"!==this.status&&await g.shutdownKernel(this.id,this.serverSettings),this.handleShutdown()}handleShutdown(){this._updateStatus("dead"),this.dispose()}async requestKernelInfo(){const e=l.createMessage({msgType:"kernel_info_request",channel:"shell",username:this._username,session:this._clientId,content:{}});let t;try{t=await f.handleShellMessage(this,e)}catch(e){if(this.isDisposed)return;throw e}if(this._errorIfDisposed(),t)return void 0===t.content.status&&(t.content.status="ok"),"ok"!==t.content.status?(this._info.reject("Kernel info reply errored"),t):(this._info.resolve(t.content),this._kernelSession=t.header.session,t)}requestComplete(e){const t=l.createMessage({msgType:"complete_request",channel:"shell",username:this._username,session:this._clientId,content:e});return f.handleShellMessage(this,t)}requestInspect(e){const t=l.createMessage({msgType:"inspect_request",channel:"shell",username:this._username,session:this._clientId,content:e});return f.handleShellMessage(this,t)}requestHistory(e){const t=l.createMessage({msgType:"history_request",channel:"shell",username:this._username,session:this._clientId,content:e});return f.handleShellMessage(this,t)}requestExecute(e,t=!0,s){const n=l.createMessage({msgType:"execute_request",channel:"shell",username:this._username,session:this._clientId,content:Object.assign(Object.assign({},{silent:!1,store_history:!0,user_expressions:{},allow_stdin:!0,stop_on_error:!1}),e),metadata:s});return this.sendShellMessage(n,!0,t)}requestDebug(e,t=!0){const s=l.createMessage({msgType:"debug_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(s,!0,t)}requestIsComplete(e){const t=l.createMessage({msgType:"is_complete_request",channel:"shell",username:this._username,session:this._clientId,content:e});return f.handleShellMessage(this,t)}requestCommInfo(e){const t=l.createMessage({msgType:"comm_info_request",channel:"shell",username:this._username,session:this._clientId,content:e});return f.handleShellMessage(this,t)}sendInputReply(e){const t=l.createMessage({msgType:"input_reply",channel:"stdin",username:this._username,session:this._clientId,content:e});this._sendMessage(t),this._anyMessage.emit({msg:t,direction:"send"})}createComm(e,t=r.UUID.uuid4()){if(!this.handleComms)throw new Error("Comms are disabled on this kernel connection");if(this._comms.has(t))throw new Error("Comm is already created");const s=new h.CommHandler(e,t,this,(()=>{this._unregisterComm(t)}));return this._comms.set(t,s),s}hasComm(e){return this._comms.has(e)}registerCommTarget(e,t){this.handleComms&&(this._targetRegistry[e]=t)}removeCommTarget(e,t){this.handleComms&&(this.isDisposed||this._targetRegistry[e]!==t||delete this._targetRegistry[e])}registerMessageHook(e,t){var s;const n=null===(s=this._futures)||void 0===s?void 0:s.get(e);n&&n.registerMessageHook(t)}removeMessageHook(e,t){var s;const n=null===(s=this._futures)||void 0===s?void 0:s.get(e);n&&n.removeMessageHook(t)}async _handleDisplayId(e,t){var s,n;const i=t.parent_header.msg_id;let o=this._displayIdToParentIds.get(e);if(o){const e={header:r.JSONExt.deepCopy(t.header),parent_header:r.JSONExt.deepCopy(t.parent_header),metadata:r.JSONExt.deepCopy(t.metadata),content:r.JSONExt.deepCopy(t.content),channel:t.channel,buffers:t.buffers?t.buffers.slice():[]};e.header.msg_type="update_display_data",await Promise.all(o.map((async t=>{const s=this._futures&&this._futures.get(t);s&&await s.handleMsg(e)})))}if("update_display_data"===t.header.msg_type)return!0;o=null!=(s=this._displayIdToParentIds.get(e))?s:[],-1===o.indexOf(i)&&o.push(i),this._displayIdToParentIds.set(e,o);const a=null!=(n=this._msgIdToDisplayIds.get(i))?n:[];return-1===a.indexOf(i)&&a.push(i),this._msgIdToDisplayIds.set(i,a),!1}async _handleRestart(){this._clearKernelState(),this._updateStatus("restarting"),setTimeout((()=>{this.reconnect(),this.requestKernelInfo()}),0)}_clearSocket(){null!==this._ws&&(this._ws.onopen=this._noOp,this._ws.onclose=this._noOp,this._ws.onerror=this._noOp,this._ws.onmessage=this._noOp,this._ws.close(),this._ws=null)}_updateStatus(e){this._status!==e&&"dead"!==this._status&&(this._status=e,f.logKernelStatus(this),this._statusChanged.emit(e),"dead"===e&&this.dispose())}_sendPending(){for(;"connected"===this.connectionStatus&&this._kernelSession!==p&&this._pendingMessages.length>0;)this._sendMessage(this._pendingMessages[0],!1),this._pendingMessages.shift()}_clearKernelState(){this._kernelSession="",this._futures.forEach((e=>{e.dispose()})),this._comms.forEach((e=>{e.dispose()})),this._msgChain=Promise.resolve(),this._futures=new Map,this._comms=new Map,this._displayIdToParentIds.clear(),this._msgIdToDisplayIds.clear()}_assertCurrentMessage(e){if(this._errorIfDisposed(),e.header.session!==this._kernelSession)throw new Error(`Canceling handling of old message: ${e.header.msg_type}`)}async _handleCommOpen(e){this._assertCurrentMessage(e);const t=e.content,s=new h.CommHandler(t.target_name,t.comm_id,this,(()=>{this._unregisterComm(t.comm_id)}));this._comms.set(t.comm_id,s);try{const n=await f.loadObject(t.target_name,t.target_module,this._targetRegistry);await n(s,e)}catch(e){throw s.close(),console.error("Exception opening new comm"),e}}async _handleCommClose(e){this._assertCurrentMessage(e);const t=e.content,s=this._comms.get(t.comm_id);if(!s)return void console.error("Comm not found for comm id "+t.comm_id);this._unregisterComm(s.commId);const n=s.onClose;n&&await n(e),s.dispose()}async _handleCommMsg(e){this._assertCurrentMessage(e);const t=e.content,s=this._comms.get(t.comm_id);if(!s)return;const n=s.onMsg;n&&await n(e)}_unregisterComm(e){this._comms.delete(e)}_updateConnectionStatus(e){this._connectionStatus!==e&&(this._connectionStatus=e,"connecting"!==e&&(this._reconnectAttempt=0,clearTimeout(this._reconnectTimeout)),"dead"!==this.status&&("connected"===e?this._pendingMessages.length>0?this._sendPending():this.requestKernelInfo():this._updateStatus("unknown")),this._connectionStatusChanged.emit(e))}async _handleMessage(e){var t,s;let n=!1;if("shutdown_reply"===e.header.msg_type&&(this._kernelSession=e.header.session,this._sendPending()),e.parent_header&&"iopub"===e.channel&&(l.isDisplayDataMsg(e)||l.isUpdateDisplayDataMsg(e)||l.isExecuteResultMsg(e))){const s=(null!=(t=e.content.transient)?t:{}).display_id;s&&(n=await this._handleDisplayId(s,e),this._assertCurrentMessage(e))}if(!n&&e.parent_header){const t=e.parent_header,n=null===(s=this._futures)||void 0===s?void 0:s.get(t.msg_id);if(n)await n.handleMsg(e),this._assertCurrentMessage(e);else{const s=t.session===this.clientId;"iopub"!==e.channel&&s&&this._unhandledMessage.emit(e)}}if("iopub"===e.channel){switch(e.header.msg_type){case"status":const t=e.content.execution_state;"autorestarting"===t&&Promise.resolve().then((async()=>{await this._handleRestart(),this._updateStatus("autorestarting")})),"restarting"===t&&Promise.resolve().then((async()=>{await this._handleRestart(),this._kernelSession=e.header.session,this._updateStatus("restarting")})),this._updateStatus(t);break;case"comm_open":this.handleComms&&await this._handleCommOpen(e);break;case"comm_msg":this.handleComms&&await this._handleCommMsg(e);break;case"comm_close":this.handleComms&&await this._handleCommClose(e)}this.isDisposed||(this._assertCurrentMessage(e),this._iopubMessage.emit(e))}}_reconnect(){if(this._errorIfDisposed(),clearTimeout(this._reconnectTimeout),this._reconnectAttempt<this._reconnectLimit){this._updateConnectionStatus("connecting");const e=f.getRandomIntInclusive(0,1e3*(Math.pow(2,this._reconnectAttempt)-1));console.error(`Connection lost, reconnecting in ${Math.floor(e/1e3)} seconds.`),this._reconnectTimeout=setTimeout(this._createSocket,e),this._reconnectAttempt+=1}else this._updateConnectionStatus("disconnected");this._clearSocket()}_errorIfDisposed(){if(this.isDisposed)throw new Error("Kernel connection is disposed")}}var f;t.KernelConnection=m,function(e){e.logKernelStatus=function(e){switch(e.status){case"idle":case"busy":case"unknown":return;default:console.debug(`Kernel: ${e.status} (${e.id})`)}},e.handleShellMessage=async function(e,t){return e.sendShellMessage(t,!0).done},e.loadObject=function(e,t,s){return new Promise(((n,i)=>{var r;if(t){if("undefined"==typeof requirejs)throw new Error("requirejs not found");requirejs([t],(s=>{void 0===s[e]?i(new Error(`Object '${e}' not found in module '${t}'`)):n(s[e])}),i)}else(null===(r=s)||void 0===r?void 0:r[e])?n(s[e]):i(new Error(`Object '${e}' not found in registry`))}))},e.getRandomIntInclusive=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}(f||(f={}))},8356:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=s(74547),r=s(18108),o=n(s(9995));class a extends r.DisposableDelegate{constructor(e,t,s,n,r){super(e),this._status=0,this._stdin=h.noOp,this._iopub=h.noOp,this._reply=h.noOp,this._done=new i.PromiseDelegate,this._hooks=new h.HookList,this._disposeOnDone=!0,this._msg=t,s||this._setFlag(h.KernelFutureFlag.GotReply),this._disposeOnDone=n,this._kernel=r}get msg(){return this._msg}get done(){return this._done.promise}get onReply(){return this._reply}set onReply(e){this._reply=e}get onIOPub(){return this._iopub}set onIOPub(e){this._iopub=e}get onStdin(){return this._stdin}set onStdin(e){this._stdin=e}registerMessageHook(e){if(this.isDisposed)throw new Error("Kernel future is disposed");this._hooks.add(e)}removeMessageHook(e){this.isDisposed||this._hooks.remove(e)}sendInputReply(e){this._kernel.sendInputReply(e)}dispose(){this._stdin=h.noOp,this._iopub=h.noOp,this._reply=h.noOp,this._hooks=null,this._testFlag(h.KernelFutureFlag.IsDone)||(this._done.promise.catch((()=>{})),this._done.reject(new Error(`Canceled future for ${this.msg.header.msg_type} message before replies were done`))),super.dispose()}async handleMsg(e){switch(e.channel){case"control":case"shell":e.channel===this.msg.channel&&e.parent_header.msg_id===this.msg.header.msg_id&&await this._handleReply(e);break;case"stdin":await this._handleStdin(e);break;case"iopub":await this._handleIOPub(e)}}async _handleReply(e){const t=this._reply;t&&await t(e),this._replyMsg=e,this._setFlag(h.KernelFutureFlag.GotReply),this._testFlag(h.KernelFutureFlag.GotIdle)&&this._handleDone()}async _handleStdin(e){const t=this._stdin;t&&await t(e)}async _handleIOPub(e){const t=await this._hooks.process(e),s=this._iopub;t&&s&&await s(e),o.isStatusMsg(e)&&"idle"===e.content.execution_state&&(this._setFlag(h.KernelFutureFlag.GotIdle),this._testFlag(h.KernelFutureFlag.GotReply)&&this._handleDone())}_handleDone(){this._testFlag(h.KernelFutureFlag.IsDone)||(this._setFlag(h.KernelFutureFlag.IsDone),this._done.resolve(this._replyMsg),this._disposeOnDone&&this.dispose())}_testFlag(e){return 0!=(this._status&e)}_setFlag(e){this._status|=e}}var h;t.KernelFutureHandler=a,t.KernelControlFutureHandler=class extends a{},t.KernelShellFutureHandler=class extends a{},function(e){e.noOp=()=>{};const t="function"==typeof requestAnimationFrame?requestAnimationFrame:setImmediate;let s;e.HookList=class{constructor(){this._hooks=[]}add(e){this.remove(e),this._hooks.push(e)}remove(e){const t=this._hooks.indexOf(e);t>=0&&(this._hooks[t]=null,this._scheduleCompact())}async process(e){await this._processing;const t=new i.PromiseDelegate;let s;this._processing=t.promise;for(let n=this._hooks.length-1;n>=0;n--){const i=this._hooks[n];if(null!==i){try{s=await i(e)}catch(e){s=!0,console.error(e)}if(!1===s)return t.resolve(void 0),!1}}return t.resolve(void 0),!0}_scheduleCompact(){this._compactScheduled||(this._compactScheduled=!0,t((()=>{this._processing=this._processing.then((()=>{this._compactScheduled=!1,this._compact()}))})))}_compact(){let e=0;for(let t=0,s=this._hooks.length;t<s;t++){const s=this._hooks[t];null===this._hooks[t]?e++:this._hooks[t-e]=s}this._hooks.length-=e}},function(e){e[e.GotReply=1]="GotReply",e[e.GotIdle=2]="GotIdle",e[e.IsDone=4]="IsDone",e[e.DisposeOnDone=8]="DisposeOnDone"}(s=e.KernelFutureFlag||(e.KernelFutureFlag={}))}(h||(h={}))},46870:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(10121));t.Kernel=i;const r=n(s(9995));t.KernelMessage=r;const o=n(s(64907));t.KernelAPI=o,function(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}(s(77442))},10121:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},77442:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(81734),i=s(54341),r=s(58646),o=s(63090),a=s(5035),h=s(64907),l=s(38898);class c extends a.BaseManager{constructor(e={}){var t;super(e),this._isReady=!1,this._kernelConnections=new Set,this._models=new Map,this._runningChanged=new r.Signal(this),this._connectionFailure=new r.Signal(this),this._pollModels=new i.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:KernelManager#models",standby:(t=e.standby,null!=t?t:"when-hidden")}),this._ready=(async()=>{await this._pollModels.start(),await this._pollModels.tick,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._models.clear(),this._kernelConnections.forEach((e=>e.dispose())),this._pollModels.dispose(),super.dispose())}connectTo(e){var t;const{id:s}=e.model;let n=null==(t=e.handleComms)||t;if(void 0===e.handleComms)for(const e of this._kernelConnections)if(e.id===s&&e.handleComms){n=!1;break}const i=new l.KernelConnection(Object.assign(Object.assign({handleComms:n},e),{serverSettings:this.serverSettings}));return this._onStarted(i),this._models.has(s)||this.refreshRunning().catch((()=>{})),i}running(){return n.iter([...this._models.values()])}async refreshRunning(){await this._pollModels.refresh(),await this._pollModels.tick}async startNew(e={},t={}){const s=await h.startNew(e,this.serverSettings);return this.connectTo(Object.assign(Object.assign({},t),{model:s}))}async shutdown(e){await h.shutdownKernel(e,this.serverSettings),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all([...this._models.keys()].map((e=>h.shutdownKernel(e,this.serverSettings)))),await this.refreshRunning()}async findById(e){return this._models.has(e)||await this.refreshRunning(),this._models.get(e)}async requestRunning(){var e;let t;try{t=await h.listRunning(this.serverSettings)}catch(t){throw(t instanceof o.ServerConnection.NetworkError||503===(null===(e=t.response)||void 0===e?void 0:e.status))&&this._connectionFailure.emit(t),t}this.isDisposed||this._models.size===t.length&&n.every(t,(e=>{const t=this._models.get(e.id);return!!t&&t.name===e.name}))||(this._models=new Map(t.map((e=>[e.id,e]))),this._kernelConnections.forEach((e=>{this._models.has(e.id)||e.handleShutdown()})),this._runningChanged.emit(t))}_onStarted(e){this._kernelConnections.add(e),e.statusChanged.connect(this._onStatusChanged,this),e.disposed.connect(this._onDisposed,this)}_onDisposed(e){this._kernelConnections.delete(e),this.refreshRunning().catch((()=>{}))}_onStatusChanged(e,t){"dead"===t&&this.refreshRunning().catch((()=>{}))}}t.KernelManager=c},9995:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(74547);t.createMessage=function(e){var t,s,i,r,o;return{buffers:(t=e.buffers,null!=t?t:[]),channel:e.channel,content:e.content,header:{date:(new Date).toISOString(),msg_id:(s=e.msgId,null!=s?s:n.UUID.uuid4()),msg_type:e.msgType,session:e.session,username:(i=e.username,null!=i?i:""),version:"5.2"},metadata:(r=e.metadata,null!=r?r:{}),parent_header:(o=e.parentHeader,null!=o?o:{})}},t.isStreamMsg=function(e){return"stream"===e.header.msg_type},t.isDisplayDataMsg=function(e){return"display_data"===e.header.msg_type},t.isUpdateDisplayDataMsg=function(e){return"update_display_data"===e.header.msg_type},t.isExecuteInputMsg=function(e){return"execute_input"===e.header.msg_type},t.isExecuteResultMsg=function(e){return"execute_result"===e.header.msg_type},t.isErrorMsg=function(e){return"error"===e.header.msg_type},t.isStatusMsg=function(e){return"status"===e.header.msg_type},t.isClearOutputMsg=function(e){return"clear_output"===e.header.msg_type},t.isDebugEventMsg=function(e){return"debug_event"===e.header.msg_type},t.isCommOpenMsg=function(e){return"comm_open"===e.header.msg_type},t.isCommCloseMsg=function(e){return"comm_close"===e.header.msg_type},t.isCommMsgMsg=function(e){return"comm_msg"===e.header.msg_type},t.isInfoRequestMsg=function(e){return"kernel_info_request"===e.header.msg_type},t.isExecuteReplyMsg=function(e){return"execute_reply"===e.header.msg_type},t.isDebugRequestMsg=function(e){return"debug_request"===e.header.msg_type},t.isDebugReplyMsg=function(e){return"debug_reply"===e.header.msg_type},t.isInputRequestMsg=function(e){return"input_request"===e.header.msg_type},t.isInputReplyMsg=function(e){return"input_reply"===e.header.msg_type}},64907:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(11129),i=s(76528),r=s(38282);t.KERNEL_SERVICE_URL="api/kernels",t.listRunning=async function(e=n.ServerConnection.makeSettings()){const s=i.URLExt.join(e.baseUrl,t.KERNEL_SERVICE_URL),o=await n.ServerConnection.makeRequest(s,{},e);if(200!==o.status)throw await n.ServerConnection.ResponseError.create(o);const a=await o.json();return r.validateModels(a),a},t.startNew=async function(e={},s=n.ServerConnection.makeSettings()){const o=i.URLExt.join(s.baseUrl,t.KERNEL_SERVICE_URL),a={method:"POST",body:JSON.stringify(e)},h=await n.ServerConnection.makeRequest(o,a,s);if(201!==h.status)throw await n.ServerConnection.ResponseError.create(h);const l=await h.json();return r.validateModel(l),l},t.restartKernel=async function(e,s=n.ServerConnection.makeSettings()){const o=i.URLExt.join(s.baseUrl,t.KERNEL_SERVICE_URL,encodeURIComponent(e),"restart"),a=await n.ServerConnection.makeRequest(o,{method:"POST"},s);if(200!==a.status)throw await n.ServerConnection.ResponseError.create(a);const h=await a.json();r.validateModel(h)},t.interruptKernel=async function(e,s=n.ServerConnection.makeSettings()){const r=i.URLExt.join(s.baseUrl,t.KERNEL_SERVICE_URL,encodeURIComponent(e),"interrupt"),o=await n.ServerConnection.makeRequest(r,{method:"POST"},s);if(204!==o.status)throw await n.ServerConnection.ResponseError.create(o)},t.shutdownKernel=async function(e,s=n.ServerConnection.makeSettings()){const r=i.URLExt.join(s.baseUrl,t.KERNEL_SERVICE_URL,encodeURIComponent(e)),o=await n.ServerConnection.makeRequest(r,{method:"DELETE"},s);if(404===o.status){const t=`The kernel "${e}" does not exist on the server`;console.warn(t)}else if(204!==o.status)throw await n.ServerConnection.ResponseError.create(o)},t.getKernelModel=async function(e,s=n.ServerConnection.makeSettings()){const o=i.URLExt.join(s.baseUrl,t.KERNEL_SERVICE_URL,encodeURIComponent(e)),a=await n.ServerConnection.makeRequest(o,{},s);if(404===a.status)return;if(200!==a.status)throw await n.ServerConnection.ResponseError.create(a);const h=await a.json();return r.validateModel(h),h}},59127:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=function(e){let t;return t="string"==typeof e?JSON.parse(e):function(e){const t=new DataView(e),s=t.getUint32(0),n=[];if(s<2)throw new Error("Invalid incoming Kernel Message");for(let e=1;e<=s;e++)n.push(t.getUint32(4*e));const i=new Uint8Array(e.slice(n[0],n[1])),r=JSON.parse(new TextDecoder("utf8").decode(i));r.buffers=[];for(let t=1;t<s;t++){const s=n[t],i=n[t+1]||e.byteLength;r.buffers.push(new DataView(e.slice(s,i)))}return r}(e),t},t.serialize=function(e){var t;let s;return s=(null===(t=e.buffers)||void 0===t?void 0:t.length)?function(e){const t=[],s=[],n=new TextEncoder;let i=[];void 0!==e.buffers&&(i=e.buffers,delete e.buffers);const r=n.encode(JSON.stringify(e));s.push(r.buffer);for(let e=0;e<i.length;e++){const t=i[e];s.push(t instanceof ArrayBuffer?t:t.buffer)}const o=s.length;t.push(4*(o+1));for(let e=0;e+1<s.length;e++)t.push(t[t.length-1]+s[e].byteLength);const a=new Uint8Array(t[t.length-1]+s[s.length-1].byteLength),h=new DataView(a.buffer);h.setUint32(0,o);for(let e=0;e<t.length;e++)h.setUint32(4*(e+1),t[e]);for(let e=0;e<s.length;e++)a.set(new Uint8Array(s[e]),t[e]);return a.buffer}(e):JSON.stringify(e),s}},38282:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(61450),i=["username","version","session","msg_id","msg_type"],r={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function o(e){n.validateProperty(e,"name","string"),n.validateProperty(e,"id","string")}t.validateMessage=function(e){n.validateProperty(e,"metadata","object"),n.validateProperty(e,"content","object"),n.validateProperty(e,"channel","string"),function(e){for(let t=0;t<i.length;t++)n.validateProperty(e,i[t],"string")}(e.header),"iopub"===e.channel&&function(e){if("iopub"===e.channel){const t=r[e.header.msg_type];if(void 0===t)return;const s=Object.keys(t),i=e.content;for(let e=0;e<s.length;e++){let r=t[s[e]];Array.isArray(r)||(r=[r]),n.validateProperty(i,s[e],...r)}}}(e)},t.validateModel=o,t.validateModels=function(e){if(!Array.isArray(e))throw new Error("Invalid kernel list");e.forEach((e=>o(e)))}},53599:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(31318));t.KernelSpec=i;const r=n(s(50019));t.KernelSpecAPI=r,function(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}(s(18770))},31318:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},18770:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=s(74547),r=s(54341),o=s(58646),a=n(s(50019)),h=s(5035);class l extends h.BaseManager{constructor(e={}){var t;super(e),this._isReady=!1,this._connectionFailure=new o.Signal(this),this._specs=null,this._specsChanged=new o.Signal(this),this._ready=Promise.all([this.requestSpecs()]).then((e=>{})).catch((e=>{})).then((()=>{this.isDisposed||(this._isReady=!0)})),this._pollSpecs=new r.Poll({auto:!1,factory:()=>this.requestSpecs(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@jupyterlab/services:KernelSpecManager#specs",standby:(t=e.standby,null!=t?t:"when-hidden")}),this.ready.then((()=>{this._pollSpecs.start()}))}get isReady(){return this._isReady}get ready(){return this._ready}get specs(){return this._specs}get specsChanged(){return this._specsChanged}get connectionFailure(){return this._connectionFailure}dispose(){this._pollSpecs.dispose(),super.dispose()}async refreshSpecs(){await this._pollSpecs.refresh(),await this._pollSpecs.tick}async requestSpecs(){const e=await a.getSpecs(this.serverSettings);this.isDisposed||i.JSONExt.deepEqual(e,this._specs)||(this._specs=e,this._specsChanged.emit(e))}}t.KernelSpecManager=l},50019:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(11129),i=s(4481),r=s(76528);t.getSpecs=async function(e=n.ServerConnection.makeSettings()){const t=r.URLExt.join(e.baseUrl,"api/kernelspecs"),s=await n.ServerConnection.makeRequest(t,{},e);if(200!==s.status)throw await n.ServerConnection.ResponseError.create(s);const o=await s.json();return i.validateSpecModels(o)}},4481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(61450);function i(e){const t=e.spec;if(!t)throw new Error("Invalid kernel spec");n.validateProperty(e,"name","string"),n.validateProperty(e,"resources","object"),n.validateProperty(t,"language","string"),n.validateProperty(t,"display_name","string"),n.validateProperty(t,"argv","array");let s=null;t.hasOwnProperty("metadata")&&(n.validateProperty(t,"metadata","object"),s=t.metadata);let i=null;return t.hasOwnProperty("env")&&(n.validateProperty(t,"env","object"),i=t.env),{name:e.name,resources:e.resources,language:t.language,display_name:t.display_name,argv:t.argv,metadata:s,env:i}}t.validateSpecModel=i,t.validateSpecModels=function(e){if(!e.hasOwnProperty("kernelspecs"))throw new Error("No kernelspecs found");let t=Object.keys(e.kernelspecs);const s=Object.create(null);let n=e.default;for(let n=0;n<t.length;n++){const r=e.kernelspecs[t[n]];try{s[t[n]]=i(r)}catch(e){console.warn(`Removing errant kernel spec: ${t[n]}`)}}if(t=Object.keys(s),!t.length)throw new Error("No valid kernelspecs found");return n&&"string"==typeof n&&n in s||(n=t[0],console.warn(`Default kernel not found, using '${t[0]}'`)),{default:n,kernelspecs:s}}},98057:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(58646),i=s(37141),r=s(53064),o=s(40657),a=s(53599),h=s(72101),l=s(61229),c=s(64021),d=s(11129),u=s(79121),_=s(46870);t.ServiceManager=class{constructor(e={}){var t,s;this._isDisposed=!1,this._connectionFailure=new n.Signal(this),this._isReady=!1;const g=e.defaultDrive,p=null!=(t=e.serverSettings)?t:d.ServerConnection.makeSettings(),m={defaultDrive:g,serverSettings:p,standby:null!=(s=e.standby)?s:"when-hidden"},f=new _.KernelManager(m);this.serverSettings=p,this.contents=new o.ContentsManager(m),this.sessions=new h.SessionManager(Object.assign(Object.assign({},m),{kernelManager:f})),this.settings=new l.SettingManager(m),this.terminals=new c.TerminalManager(m),this.builder=new i.BuildManager(m),this.workspaces=new u.WorkspaceManager(m),this.nbconvert=new r.NbConvertManager(m),this.kernelspecs=new a.KernelSpecManager(m),this.kernelspecs.connectionFailure.connect(this._onConnectionFailure,this),this.sessions.connectionFailure.connect(this._onConnectionFailure,this),this.terminals.connectionFailure.connect(this._onConnectionFailure,this);const v=[this.sessions.ready,this.kernelspecs.ready];this.terminals.isAvailable()&&v.push(this.terminals.ready),this._readyPromise=Promise.all(v).then((()=>{this._isReady=!0}))}get connectionFailure(){return this._connectionFailure}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,n.Signal.clearData(this),this.contents.dispose(),this.sessions.dispose(),this.terminals.dispose())}get isReady(){return this._isReady}get ready(){return this._readyPromise}_onConnectionFailure(e,t){this._connectionFailure.emit(t)}}},53064:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(76528),i=s(11129);t.NbConvertManager=class{constructor(e={}){var t;this.serverSettings=null!=(t=e.serverSettings)?t:i.ServerConnection.makeSettings()}async getExportFormats(){const e=this.serverSettings.baseUrl,t=n.URLExt.join(e,"api/nbconvert"),{serverSettings:s}=this,r=await i.ServerConnection.makeRequest(t,{},s);if(200!==r.status)throw await i.ServerConnection.ResponseError.create(r);const o=await r.json(),a={};return Object.keys(o).forEach((function(e){const t=o[e].output_mimetype;a[e]={output_mimetype:t}})),a}}},11129:(e,t,s)=>{var n,i,r;Object.defineProperty(t,"__esModule",{value:!0});const o=s(76528);let a,h,l,c;if("undefined"==typeof window){const e=s(3174);n=s.g.fetch,a=null!=n?n:e,i=s.g.Request,l=null!=i?i:e.Request,r=s.g.Headers,h=null!=r?r:e.Headers,c=s(5917)}else a=fetch,l=Request,h=Headers,c=WebSocket;var d,u;!function(e){e.makeSettings=function(e){return u.makeSettings(e)},e.makeRequest=function(e,t,s){return u.handleRequest(e,t,s)};class t extends Error{constructor(e,t=`Invalid response: ${e.status} ${e.statusText}`,s=""){super(t),this.response=e,this.traceback=s}static async create(e){try{const s=await e.json();return s.traceback&&console.error(s.traceback),s.message?new t(e,s.message):new t(e)}catch(s){return console.debug(s),new t(e)}}}e.ResponseError=t;class s extends TypeError{constructor(e){super(e.message),this.stack=e.stack}}e.NetworkError=s}(d=t.ServerConnection||(t.ServerConnection={})),function(e){e.makeSettings=function(e={}){const t=o.PageConfig.getBaseUrl(),s=o.PageConfig.getWsUrl(),n=o.URLExt.normalize(e.baseUrl)||t;let i=e.wsUrl;return i||n!==t||(i=s),i||0!==n.indexOf("http")||(i="ws"+n.slice(4)),i=null!=i?i:s,Object.assign(Object.assign({init:{cache:"no-store",credentials:"same-origin"},fetch:a,Headers:h,Request:l,WebSocket:c,token:o.PageConfig.getToken(),appUrl:o.PageConfig.getOption("appUrl")},e),{baseUrl:n,wsUrl:i})},e.handleRequest=function(e,t,s){var n,i;if(0!==e.indexOf(s.baseUrl))throw new Error("Can only be used for notebook server requests");"no-store"===(null!=(n=t.cache)?n:s.init.cache)&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());const r=new s.Request(e,Object.assign(Object.assign({},s.init),t));let o=!1;if(s.token&&(o=!0,r.headers.append("Authorization",`token ${s.token}`)),"undefined"!=typeof document&&(null===(i=document)||void 0===i?void 0:i.cookie)){const e=function(e){var t;return null===(t=document.cookie.match("\\b_xsrf=([^;]*)\\b"))||void 0===t?void 0:t[1]}();void 0!==e&&(o=!0,r.headers.append("X-XSRFToken",e))}return!r.headers.has("Content-Type")&&o&&r.headers.set("Content-Type","application/json"),s.fetch.call(null,r).catch((e=>{throw new d.NetworkError(e)}))}}(u||(u={}))},59392:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(58646),i=s(63090),r=s(73869),o=s(74547);t.SessionConnection=class{constructor(e){var t,s,r,a;this._id="",this._path="",this._name="",this._type="",this._kernel=null,this._isDisposed=!1,this._disposed=new n.Signal(this),this._kernelChanged=new n.Signal(this),this._statusChanged=new n.Signal(this),this._connectionStatusChanged=new n.Signal(this),this._iopubMessage=new n.Signal(this),this._unhandledMessage=new n.Signal(this),this._anyMessage=new n.Signal(this),this._propertyChanged=new n.Signal(this),this._id=e.model.id,this._name=e.model.name,this._path=e.model.path,this._type=e.model.type,this._username=null!=(t=e.username)?t:"",this._clientId=null!=(s=e.clientId)?s:o.UUID.uuid4(),this._connectToKernel=e.connectToKernel,this._kernelConnectionOptions=null!=(r=e.kernelConnectionOptions)?r:{},this.serverSettings=null!=(a=e.serverSettings)?a:i.ServerConnection.makeSettings(),this.setupKernel(e.model.kernel)}get disposed(){return this._disposed}get kernelChanged(){return this._kernelChanged}get statusChanged(){return this._statusChanged}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get anyMessage(){return this._anyMessage}get propertyChanged(){return this._propertyChanged}get id(){return this._id}get kernel(){return this._kernel}get path(){return this._path}get type(){return this._type}get name(){return this._name}get model(){return{id:this.id,kernel:this.kernel&&{id:this.kernel.id,name:this.kernel.name},path:this._path,type:this._type,name:this._name}}get isDisposed(){return this._isDisposed}update(e){const t=this.model;if(this._path=e.path,this._name=e.name,this._type=e.type,null===this._kernel&&null!==e.kernel||null!==this._kernel&&null===e.kernel||null!==this._kernel&&null!==e.kernel&&this._kernel.id!==e.kernel.id){null!==this._kernel&&this._kernel.dispose();const t=this._kernel;this.setupKernel(e.kernel);const s=this._kernel;this._kernelChanged.emit({name:"kernel",oldValue:t,newValue:s})}this._handleModelChange(t)}dispose(){if(!this.isDisposed){if(this._isDisposed=!0,this._disposed.emit(),this._kernel){this._kernel.dispose();const e=this._kernel;this._kernel=null;const t=this._kernel;this._kernelChanged.emit({name:"kernel",oldValue:e,newValue:t})}n.Signal.clearData(this)}}async setPath(e){if(this.isDisposed)throw new Error("Session is disposed");await this._patch({path:e})}async setName(e){if(this.isDisposed)throw new Error("Session is disposed");await this._patch({name:e})}async setType(e){if(this.isDisposed)throw new Error("Session is disposed");await this._patch({type:e})}async changeKernel(e){if(this.isDisposed)throw new Error("Session is disposed");return await this._patch({kernel:e}),this.kernel}async shutdown(){if(this.isDisposed)throw new Error("Session is disposed");await r.shutdownSession(this.id,this.serverSettings),this.dispose()}setupKernel(e){if(null===e)return void(this._kernel=null);const t=this._connectToKernel(Object.assign(Object.assign({},this._kernelConnectionOptions),{model:e,username:this._username,clientId:this._clientId,serverSettings:this.serverSettings}));this._kernel=t,t.statusChanged.connect(this.onKernelStatus,this),t.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.anyMessage.connect(this.onAnyMessage,this)}onKernelStatus(e,t){this._statusChanged.emit(t)}onKernelConnectionStatus(e,t){this._connectionStatusChanged.emit(t)}onIOPubMessage(e,t){this._iopubMessage.emit(t)}onUnhandledMessage(e,t){this._unhandledMessage.emit(t)}onAnyMessage(e,t){this._anyMessage.emit(t)}async _patch(e){const t=await r.updateSession(Object.assign(Object.assign({},e),{id:this._id}),this.serverSettings);return this.update(t),t}_handleModelChange(e){e.name!==this._name&&this._propertyChanged.emit("name"),e.type!==this._type&&this._propertyChanged.emit("type"),e.path!==this._path&&this._propertyChanged.emit("path")}}},72101:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(8057));t.Session=i;const r=n(s(73869));t.SessionAPI=r,function(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}(s(92829))},92829:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(81734),i=s(54341),r=s(58646),o=s(11129),a=s(5035),h=s(59392),l=s(73869);class c extends a.BaseManager{constructor(e){var t;super(e),this._isReady=!1,this._sessionConnections=new Set,this._models=new Map,this._runningChanged=new r.Signal(this),this._connectionFailure=new r.Signal(this),this._connectToKernel=e=>this._kernelManager.connectTo(e),this._kernelManager=e.kernelManager,this._pollModels=new i.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:SessionManager#models",standby:(t=e.standby,null!=t?t:"when-hidden")}),this._ready=(async()=>{await this._pollModels.start(),await this._pollModels.tick,await this._kernelManager.ready,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._models.clear(),this._sessionConnections.forEach((e=>e.dispose())),this._pollModels.dispose(),super.dispose())}connectTo(e){const t=new h.SessionConnection(Object.assign(Object.assign({},e),{connectToKernel:this._connectToKernel,serverSettings:this.serverSettings}));return this._onStarted(t),this._models.has(e.model.id)||this.refreshRunning().catch((()=>{})),t}running(){return n.iter([...this._models.values()])}async refreshRunning(){await this._pollModels.refresh(),await this._pollModels.tick}async startNew(e,t={}){const s=await l.startSession(e,this.serverSettings);return await this.refreshRunning(),this.connectTo(Object.assign(Object.assign({},t),{model:s}))}async shutdown(e){await l.shutdownSession(e,this.serverSettings),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all([...this._models.keys()].map((e=>l.shutdownSession(e,this.serverSettings)))),await this.refreshRunning()}async stopIfNeeded(e){try{const t=(await l.listRunning(this.serverSettings)).filter((t=>t.path===e));if(1===t.length){const e=t[0].id;await this.shutdown(e)}}catch(e){}}async findById(e){return this._models.has(e)||await this.refreshRunning(),this._models.get(e)}async findByPath(e){for(const t of this._models.values())if(t.path===e)return t;await this.refreshRunning();for(const t of this._models.values())if(t.path===e)return t}async requestRunning(){var e;let t;try{t=await l.listRunning(this.serverSettings)}catch(t){throw(t instanceof o.ServerConnection.NetworkError||503===(null===(e=t.response)||void 0===e?void 0:e.status))&&this._connectionFailure.emit(t),t}this.isDisposed||this._models.size===t.length&&n.every(t,(e=>{var t,s,n,i;const r=this._models.get(e.id);return!!r&&(null===(t=r.kernel)||void 0===t?void 0:t.id)===(null===(s=e.kernel)||void 0===s?void 0:s.id)&&(null===(n=r.kernel)||void 0===n?void 0:n.name)===(null===(i=e.kernel)||void 0===i?void 0:i.name)&&r.name===e.name&&r.path===e.path&&r.type===e.type}))||(this._models=new Map(t.map((e=>[e.id,e]))),this._sessionConnections.forEach((e=>{this._models.has(e.id)?e.update(this._models.get(e.id)):e.dispose()})),this._runningChanged.emit(t))}_onStarted(e){this._sessionConnections.add(e),e.disposed.connect(this._onDisposed,this),e.propertyChanged.connect(this._onChanged,this),e.kernelChanged.connect(this._onChanged,this)}_onDisposed(e){this._sessionConnections.delete(e),this.refreshRunning().catch((()=>{}))}_onChanged(){this.refreshRunning().catch((()=>{}))}}t.SessionManager=c},73869:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(11129),i=s(76528),r=s(33788);function o(e,s){return i.URLExt.join(e,t.SESSION_SERVICE_URL,s)}t.SESSION_SERVICE_URL="api/sessions",t.listRunning=async function(e=n.ServerConnection.makeSettings()){const s=i.URLExt.join(e.baseUrl,t.SESSION_SERVICE_URL),o=await n.ServerConnection.makeRequest(s,{},e);if(200!==o.status)throw await n.ServerConnection.ResponseError.create(o);const a=await o.json();if(!Array.isArray(a))throw new Error("Invalid Session list");return a.forEach((e=>{r.updateLegacySessionModel(e),r.validateModel(e)})),a},t.getSessionUrl=o,t.shutdownSession=async function(e,t=n.ServerConnection.makeSettings()){var s;const i=o(t.baseUrl,e),r=await n.ServerConnection.makeRequest(i,{method:"DELETE"},t);if(404===r.status){const t=null!=(s=(await r.json()).message)?s:`The session "${e}"" does not exist on the server`;console.warn(t)}else{if(410===r.status)throw new n.ServerConnection.ResponseError(r,"The kernel was deleted but the session was not");if(204!==r.status)throw await n.ServerConnection.ResponseError.create(r)}},t.getSessionModel=async function(e,t=n.ServerConnection.makeSettings()){const s=o(t.baseUrl,e),i=await n.ServerConnection.makeRequest(s,{},t);if(200!==i.status)throw await n.ServerConnection.ResponseError.create(i);const a=await i.json();return r.updateLegacySessionModel(a),r.validateModel(a),a},t.startSession=async function(e,s=n.ServerConnection.makeSettings()){const o=i.URLExt.join(s.baseUrl,t.SESSION_SERVICE_URL),a={method:"POST",body:JSON.stringify(e)},h=await n.ServerConnection.makeRequest(o,a,s);if(201!==h.status)throw await n.ServerConnection.ResponseError.create(h);const l=await h.json();return r.updateLegacySessionModel(l),r.validateModel(l),l},t.updateSession=async function(e,t=n.ServerConnection.makeSettings()){const s=o(t.baseUrl,e.id),i={method:"PATCH",body:JSON.stringify(e)},a=await n.ServerConnection.makeRequest(s,i,t);if(200!==a.status)throw await n.ServerConnection.ResponseError.create(a);const h=await a.json();return r.updateLegacySessionModel(h),r.validateModel(h),h}},8057:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},33788:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(38282),i=s(61450);function r(e){i.validateProperty(e,"id","string"),i.validateProperty(e,"type","string"),i.validateProperty(e,"name","string"),i.validateProperty(e,"path","string"),i.validateProperty(e,"kernel","object"),n.validateModel(e.kernel)}t.validateModel=r,t.updateLegacySessionModel=function(e){void 0===e.path&&void 0!==e.notebook&&(e.path=e.notebook.path,e.type="notebook",e.name="")},t.validateModels=function(e){if(!Array.isArray(e))throw new Error("Invalid session list");e.forEach((e=>r(e)))}},61229:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(76528),i=s(54032),r=s(11129);class o extends i.DataConnector{constructor(e={}){var t;super(),this.serverSettings=null!=(t=e.serverSettings)?t:r.ServerConnection.makeSettings()}async fetch(e){if(!e)throw new Error("Plugin `id` parameter is required for settings fetch.");const{serverSettings:t}=this,{baseUrl:s,appUrl:n}=t,{makeRequest:i,ResponseError:o}=r.ServerConnection,h=s+n,l=a.url(h,e),c=await i(l,{},t);if(200!==c.status)throw await o.create(c);return c.json()}async list(){var e,t,s;const{serverSettings:n}=this,{baseUrl:i,appUrl:o}=n,{makeRequest:h,ResponseError:l}=r.ServerConnection,c=i+o,d=a.url(c,""),u=await h(d,{},n);if(200!==u.status)throw new l(u);const _=null!=(s=null===(t=null===(e=await u.json())||void 0===e?void 0:e.settings)||void 0===t?void 0:t.map((e=>(e.data={composite:{},user:{}},e))))?s:[];return{ids:_.map((e=>e.id)),values:_}}async save(e,t){const{serverSettings:s}=this,{baseUrl:n,appUrl:i}=s,{makeRequest:o,ResponseError:h}=r.ServerConnection,l=n+i,c=a.url(l,e),d={body:t,method:"PUT"},u=await o(c,d,s);if(204!==u.status)throw new h(u)}}var a;t.SettingManager=o,function(e){e.url=function(e,t){return n.URLExt.join(e,"api/settings",t)}}(a||(a={}))},5917:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=WebSocket},46072:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(76528),i=s(74547),r=s(58646),o=s(63090),a=s(96460);class h{constructor(e){var t;this._createSocket=()=>{this._errorIfDisposed(),this._clearSocket(),this._updateConnectionStatus("connecting");const e=this._name,t=this.serverSettings;let s=n.URLExt.join(t.wsUrl,"terminals","websocket",encodeURIComponent(e));this._ws=new t.WebSocket(s),this._ws.onmessage=this._onWSMessage,this._ws.onclose=this._onWSClose,this._ws.onerror=this._onWSClose},this._onWSMessage=e=>{if(this._isDisposed)return;const t=JSON.parse(e.data);"disconnect"===t[0]&&this.dispose(),"connecting"!==this._connectionStatus?this._messageReceived.emit({type:t[0],content:t.slice(1)}):"setup"===t[0]&&this._updateConnectionStatus("connected")},this._onWSClose=e=>{console.warn(`Terminal websocket closed: ${e.code}`),this.isDisposed||this._reconnect()},this._connectionStatus="connecting",this._connectionStatusChanged=new r.Signal(this),this._isDisposed=!1,this._disposed=new r.Signal(this),this._messageReceived=new r.Signal(this),this._reconnectTimeout=null,this._ws=null,this._noOp=()=>{},this._reconnectLimit=7,this._reconnectAttempt=0,this._pendingMessages=[],this._name=e.model.name,this.serverSettings=null!=(t=e.serverSettings)?t:o.ServerConnection.makeSettings(),this._createSocket()}get disposed(){return this._disposed}get messageReceived(){return this._messageReceived}get name(){return this._name}get model(){return{name:this._name}}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._updateConnectionStatus("disconnected"),this._clearSocket(),r.Signal.clearData(this))}send(e){this._sendMessage(e)}_sendMessage(e,t=!0){if(!this._isDisposed&&e.content)if("connected"===this.connectionStatus&&this._ws){const t=[e.type,...e.content];this._ws.send(JSON.stringify(t))}else{if(!t)throw new Error(`Could not send message: ${JSON.stringify(e)}`);this._pendingMessages.push(e)}}_sendPending(){for(;"connected"===this.connectionStatus&&this._pendingMessages.length>0;)this._sendMessage(this._pendingMessages[0],!1),this._pendingMessages.shift()}reconnect(){this._errorIfDisposed();const e=new i.PromiseDelegate,t=(s,n)=>{"connected"===n?(e.resolve(),this.connectionStatusChanged.disconnect(t,this)):"disconnected"===n&&(e.reject(new Error("Terminal connection disconnected")),this.connectionStatusChanged.disconnect(t,this))};return this.connectionStatusChanged.connect(t,this),this._reconnectAttempt=0,this._reconnect(),e.promise}_reconnect(){if(this._errorIfDisposed(),clearTimeout(this._reconnectTimeout),this._reconnectAttempt<this._reconnectLimit){this._updateConnectionStatus("connecting");const e=l.getRandomIntInclusive(0,1e3*(Math.pow(2,this._reconnectAttempt)-1));console.error(`Connection lost, reconnecting in ${Math.floor(e/1e3)} seconds.`),this._reconnectTimeout=setTimeout(this._createSocket,e),this._reconnectAttempt+=1}else this._updateConnectionStatus("disconnected");this._clearSocket()}_clearSocket(){null!==this._ws&&(this._ws.onopen=this._noOp,this._ws.onclose=this._noOp,this._ws.onerror=this._noOp,this._ws.onmessage=this._noOp,this._ws.close(),this._ws=null)}async shutdown(){await a.shutdownTerminal(this.name,this.serverSettings),this.dispose()}clone(){return new h(this)}_updateConnectionStatus(e){this._connectionStatus!==e&&(this._connectionStatus=e,"connecting"!==e&&(this._reconnectAttempt=0,clearTimeout(this._reconnectTimeout)),"connected"===e&&this._sendPending(),this._connectionStatusChanged.emit(e))}_errorIfDisposed(){if(this.isDisposed)throw new Error("Terminal connection is disposed")}get connectionStatusChanged(){return this._connectionStatusChanged}get connectionStatus(){return this._connectionStatus}}var l;t.TerminalConnection=h,function(e){e.getTermUrl=function(e,t){return n.URLExt.join(e,a.TERMINAL_SERVICE_URL,encodeURIComponent(t))},e.getRandomIntInclusive=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}(l||(l={}))},64021:function(e,t,s){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(69193));t.Terminal=i;const r=n(s(96460));t.TerminalAPI=r,function(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}(s(53524))},53524:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(81734),i=s(54341),r=s(58646),o=s(63090),a=s(5035),h=s(96460),l=s(46072);class c extends a.BaseManager{constructor(e={}){var t;if(super(e),this._isReady=!1,this._names=[],this._terminalConnections=new Set,this._runningChanged=new r.Signal(this),this._connectionFailure=new r.Signal(this),!this.isAvailable())return this._ready=Promise.reject("Terminals unavailable"),void this._ready.catch((e=>{}));this._pollModels=new i.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:TerminalManager#models",standby:(t=e.standby,null!=t?t:"when-hidden")}),this._ready=(async()=>{await this._pollModels.start(),await this._pollModels.tick,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._names.length=0,this._terminalConnections.forEach((e=>e.dispose())),this._pollModels.dispose(),super.dispose())}isAvailable(){return h.isAvailable()}connectTo(e){const t=new l.TerminalConnection(Object.assign(Object.assign({},e),{serverSettings:this.serverSettings}));return this._onStarted(t),this._names.includes(e.model.name)||this.refreshRunning().catch((()=>{})),t}running(){return n.iter(this._models)}async refreshRunning(){await this._pollModels.refresh(),await this._pollModels.tick}async startNew(){const e=await h.startNew(this.serverSettings);return await this.refreshRunning(),this.connectTo({model:e})}async shutdown(e){await h.shutdownTerminal(e,this.serverSettings),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all(this._names.map((e=>h.shutdownTerminal(e,this.serverSettings)))),await this.refreshRunning()}async requestRunning(){var e;let t;try{t=await h.listRunning(this.serverSettings)}catch(t){throw(t instanceof o.ServerConnection.NetworkError||503===(null===(e=t.response)||void 0===e?void 0:e.status))&&this._connectionFailure.emit(t),t}if(this.isDisposed)return;const s=t.map((({name:e})=>e)).sort();s!==this._names&&(this._names=s,this._terminalConnections.forEach((e=>{s.includes(e.name)||e.dispose()})),this._runningChanged.emit(this._models))}_onStarted(e){this._terminalConnections.add(e),e.disposed.connect(this._onDisposed,this)}_onDisposed(e){this._terminalConnections.delete(e),this.refreshRunning().catch((()=>{}))}get _models(){return this._names.map((e=>({name:e})))}}t.TerminalManager=c},96460:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(76528),i=s(11129);function r(){return"true"===String(n.PageConfig.getOption("terminalsAvailable")).toLowerCase()}var o;t.TERMINAL_SERVICE_URL="api/terminals",t.isAvailable=r,t.startNew=async function(e=i.ServerConnection.makeSettings()){o.errorIfNotAvailable();const s=n.URLExt.join(e.baseUrl,t.TERMINAL_SERVICE_URL),r=await i.ServerConnection.makeRequest(s,{method:"POST"},e);if(200!==r.status)throw await i.ServerConnection.ResponseError.create(r);return await r.json()},t.listRunning=async function(e=i.ServerConnection.makeSettings()){o.errorIfNotAvailable();const s=n.URLExt.join(e.baseUrl,t.TERMINAL_SERVICE_URL),r=await i.ServerConnection.makeRequest(s,{},e);if(200!==r.status)throw await i.ServerConnection.ResponseError.create(r);const a=await r.json();if(!Array.isArray(a))throw new Error("Invalid terminal list");return a},t.shutdownTerminal=async function(e,s=i.ServerConnection.makeSettings()){var r;o.errorIfNotAvailable();const a=n.URLExt.join(s.baseUrl,t.TERMINAL_SERVICE_URL,e),h=await i.ServerConnection.makeRequest(a,{method:"DELETE"},s);if(404===h.status){const t=null!=(r=(await h.json()).message)?r:`The terminal session "${e}"" does not exist on the server`;console.warn(t)}else if(204!==h.status)throw await i.ServerConnection.ResponseError.create(h)},function(e){e.errorIfNotAvailable=function(){if(!r())throw new Error("Terminals Unavailable")}}(o||(o={}))},69193:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(96460);t.isAvailable=n.isAvailable},61450:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateProperty=function(e,t,s,n=[]){if(!e.hasOwnProperty(t))throw Error(`Missing property '${t}'`);const i=e[t];if(void 0!==s){let e=!0;switch(s){case"array":e=Array.isArray(i);break;case"object":e=void 0!==i;break;default:e=typeof i===s}if(!e)throw new Error(`Property '${t}' is not of type '${s}'`);if(n.length>0){let e=!0;switch(s){case"string":case"number":case"boolean":e=n.includes(i);break;default:e=n.findIndex((e=>e===i))>=0}if(!e)throw new Error(`Property '${t}' is not one of the valid values ${JSON.stringify(n)}`)}}}},79121:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(76528),i=s(54032),r=s(11129);class o extends i.DataConnector{constructor(e={}){var t;super(),this.serverSettings=null!=(t=e.serverSettings)?t:r.ServerConnection.makeSettings()}async fetch(e){const{serverSettings:t}=this,{baseUrl:s,appUrl:n}=t,{makeRequest:i,ResponseError:o}=r.ServerConnection,h=s+n,l=a.url(h,e),c=await i(l,{},t);if(200!==c.status)throw await o.create(c);return c.json()}async list(){const{serverSettings:e}=this,{baseUrl:t,appUrl:s}=e,{makeRequest:n,ResponseError:i}=r.ServerConnection,o=t+s,h=a.url(o,""),l=await n(h,{},e);if(200!==l.status)throw await i.create(l);return(await l.json()).workspaces}async remove(e){const{serverSettings:t}=this,{baseUrl:s,appUrl:n}=t,{makeRequest:i,ResponseError:o}=r.ServerConnection,h=s+n,l=a.url(h,e),c=await i(l,{method:"DELETE"},t);if(204!==c.status)throw await o.create(c)}async save(e,t){const{serverSettings:s}=this,{baseUrl:n,appUrl:i}=s,{makeRequest:o,ResponseError:h}=r.ServerConnection,l=n+i,c=a.url(l,e),d={body:JSON.stringify(t),method:"PUT"},u=await o(c,d,s);if(204!==u.status)throw await h.create(u)}}var a;t.WorkspaceManager=o,function(e){e.url=function(e,t){return n.URLExt.join(e,"api/workspaces",t)}}(a||(a={}))}}]);
//# sourceMappingURL=3090.e048ab1.js.map